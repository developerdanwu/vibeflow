# Frontend Source Code Guide

## Structure

```
src/
├── routes/           # TanStack Router file-based routes
├── components/       # React components
│   ├── ui/          # shadcn/ui primitives (29 components)
│   ├── (calendar feature under routes/_authenticated/calendar/-components/calendar/)
│   ├── layouts/     # Page layout wrappers
│   └── dialogs/     # Global dialog components
├── hooks/           # Custom React hooks
├── lib/             # Utilities and helpers
├── integrations/    # External service setup (TanStack Query)
├── data/            # Static/demo data
├── styles/          # Additional CSS (calendar.css)
└── test/            # Test setup
```

## Key Patterns

### Routing
- File-based routing via TanStack Router
- **Root:** `__root.tsx`, `_authenticated/route.tsx`, `index.tsx` (app-wide layout and top-level routes); WorkOS auth callback at `oauth/workos-callback.tsx`
- **Feature folders** under `_authenticated/`: one folder per feature (e.g. `calendar/`, `settings/`) with `route.tsx` as the segment layout (TanStack Router default `routeToken`), plus `index.tsx` and child route files. See [src/docs/routing.md](src/docs/routing.md) for layout-in-folder pattern and route tree regeneration.
- **Folder without layout:** A folder that only contains child route files (e.g. `oauth/linear-callback.tsx`) does not require an explicit parent layout file (`oauth.tsx`). The router plugin infers the segment from the folder name.
- Add new routes for a feature in the appropriate file under that feature's folder.

### Components
- **UI primitives** (`components/ui/`): shadcn/ui components, use `pnpm dlx shadcn@latest add [name]` to add new ones (see root AGENTS.md for shadcn overwrite/install rules)
- **Feature modules** (e.g. `routes/…/calendar/-components/calendar/`): Self-contained with own contexts, hooks, stores, and types
- **Layouts**: Wrap routes with consistent structure
- **No `"use client"`**: Omit it. The app is a Vite/TanStack Router SPA, so all components are client-rendered by default. Adding `"use client"` is unnecessary and can confuse (e.g. copy-paste from Next.js).

### State Management
- **Server state**: TanStack Query + Convex
- **Client state**: XState Store (calendar module `store/calendarStore.ts`; global UI in `lib/global-store.tsx`)
- **Context**: React Context for component trees (calendar module `contexts/`)
- **XState Store patterns:** See [src/docs/state.md](src/docs/state.md) for sending events and context handler return shape.

### Styling
- Tailwind CSS v4
- Use `cn()` from `lib/utils.ts` for conditional classes
- Component variants via `class-variance-authority`

## Do Not Edit

- `styles.css` - Generated by Tailwind
- `routeTree.gen.ts` - Generated by TanStack Router (see root AGENTS.md for full list of generated files)

## Adding New Code

| Type | Location | Convention |
|------|----------|------------|
| Page | `routes/` | `kebab-case.tsx` |
| Component | `components/` | `PascalCase.tsx` |
| Hook | `hooks/` | `use-kebab-case.ts` |
| Utility | `lib/` | `camelCase.ts` |

## Calendar Module

The calendar feature lives under `routes/_authenticated/calendar/-components/calendar/`. Key files:

- `types.ts` - Core types (`TCalendarView`, `TEventColor`, etc.)
- `interfaces.ts` - Event and calendar interfaces
- `schemas.ts` - Zod validation schemas
- `contexts/calendar-context.tsx` - Calendar state provider
- `store/calendarStore.ts` - XState store for UI state
- `hooks/` - `use-add-event`, `use-create-event-mutation`, `use-update-event-mutation`, `use-delete-event-mutation`, `use-drag-to-create`

### Views
- `month-view/` - Month grid with day cells and event badges
- `week-and-day-view/` - Time-based views with event blocks
- `year-view/` - Year overview
- `agenda-view/` - List-style event view

### Features
- `dnd/` - Drag and drop (@dnd-kit/core)
- `dialogs/` - Add/edit/details event dialogs
- `header/` - Navigation and view controls

### Related Documentation
- **State (XState Store):** See [src/docs/state.md](src/docs/state.md) for sending events and context handler return shape.
- **Drag and Drop:** See [src/docs/dnd-handling.md](src/docs/dnd-handling.md) for locked event handling and drag prevention patterns
- **Form composition:** See [src/docs/ui.md](src/docs/ui.md) (TanStack Form → Breaking big forms into smaller pieces) for withForm in child files, shared form-options, and props typing
